<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>KmbETA</title>

    <!-- Bootstrap Core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- MetisMenu CSS -->
    <link href="vendor/metisMenu/metisMenu.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="dist/css/sb-admin-2.css" rel="stylesheet">

    <!-- Morris Charts CSS -->
    <link href="vendor/morrisjs/morris.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    
    <!-- w3data include HTML JavaScript -->
    <script src="js/w3data.js"></script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <div id="wrapper">

        <!-- Navigation -->
        <div w3-include-html="nav.html"></div>

        <div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header">Dashboard</h1>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                        	<i class="fa fa-info-circle"></i> About KmbETA-API
                        </div>
                        <div class="panel-body">
                        	<p>KmbETA-API is an unofficial API to expose KMB's buses ETA data, to integrate with home automation systems or personal alarms.</p>
                        </div>
                        <div class="panel-footer">
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.row -->
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                        	<i class="fa fa-info-circle"></i> JavaDoc
                        </div>
                        <div class="panel-body">
                        	<p>Document for current version: <a href="doc-1.0.0-SNAPSHOT" target="_blank">1.0.0-SNAPSHOT</a></p>
                        </div>
                        <div class="panel-footer">
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.row -->
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                        	<i class="fa fa-info-circle"></i> 
							JS API Test
                        </div>
                        <div class="panel-body">
						    This is only a test to the JS API.
							
							<input type="button" class="btn btn-success" onclick="updateRoutes()" value="update routes"/>
							<div class="form-group">
							    <label>Route:</label>
							    <select id="routes" onchange="updateBounds()" class="form-control">
								
								</select>
							</div>
							<div class="form-group">
							    <label>Bounds:</label>
							    <select id="bounds" onchange="updateStops()" class="form-control">
								
								</select>
							</div>
							<div class="form-group">
							    <label>Stops:</label>
							    <select id="stops" onchange="updateEta()" class="form-control">
								
								</select>
							</div>
							<p id="eta">select route,bound,stop for eta</p>
                        </div>
                        <div class="panel-footer">
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.row -->
        </div>
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->

    <!-- jQuery -->
    <script src="../vendor/jquery/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="../vendor/bootstrap/js/bootstrap.min.js"></script>

    <!-- Metis Menu Plugin JavaScript -->
    <script src="../vendor/metisMenu/metisMenu.min.js"></script>

    <!-- Morris Charts JavaScript -->
    <script src="../vendor/raphael/raphael.min.js"></script>
    <script src="../vendor/morrisjs/morris.min.js"></script>
    <script src="../data/morris-data.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="../dist/js/sb-admin-2.js"></script>
    
    <a href="https://github.com/mob41/KmbETA-API"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a>

	<script src="js/KmbETA.js"></script>
	
    <script>
    w3IncludeHTML();
	
	var db = new Database();
	
	function updateRoutes(){
	    $("#routes").html("");
		var out = [];
		for (var i = 0; i < db.db.routes.length; i++){
		    out.push("<option value=\"" + i + "\">" + db.db.routes[i] + "</option>");
		}
		$("#routes").html(out.join(''));
	}
	
	function updateBounds(){
	    var ri = parseInt($("#routes").val());
		
	    $("#bounds").html("");
		var out = [];
		for (var i = 0; i < db.db.buses[ri].bounds.length; i++){
		    out.push("<option value=\"" + i + "\">" + i + "</option>");
		}
		$("#bounds").html(out.join(''));
	}
	
	function updateStops(){
	    var ri = parseInt($("#routes").val());
	    var bi = parseInt($("#bounds").val());
		
	    $("#stops").html("");
		var out = [];
		for (var i = 0; i < db.db.buses[ri].bounds[bi].stops.length; i++){
		    out.push("<option value=\"" + i + "\">[" + i + "] " + db.db.buses[ri].bounds[bi].stops[i].stopname_eng + " (" + db.db.buses[ri].bounds[bi].stops[i].stopcode + ")</option>");
		}
		$("#stops").html(out.join(''));
	}
	
	function updateEta(){
	    var ri = parseInt($("#routes").val());
	    var bi = parseInt($("#bounds").val());
	    var si = parseInt($("#stops").val());
		
		$("#eta").html("Fetching...");
		var am = new ArrivalManager(db.db.buses[ri].name, (bi + 1), db.db.buses[ri].bounds[bi].stops[si].stopcode, 0, si);
		am.getEtaData().done(function(){
			$("#eta").html(am.etaData);
		});
	}
    </script>
</body>

</html>
